<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Ashika Jain Yoga Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="blog-style.css">
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Configuration -->
    <script src="config.js"></script>
</head>

<body>

    <div class="main-container">
        <!-- Header -->
        <header>
            <div class="logo">
                <div class="logo-circle">AJ</div>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">HOME</a></li>
                    <li><a href="about.html">ABOUT</a></li>
                    <li><a href="classes.html">CLASSES</a></li>
                    <li><a href="blog.html" class="active">BLOG</a></li>
                    <li><a href="contact.html">CONTACT US</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <a href="contact.html#contact-form" class="book-btn">BOOK CLASS</a>
                <div class="menu-icon" id="mobile-menu-toggle">
                    <i class="fa-solid fa-bars"></i>
                </div>
            </div>
        </header>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobile-menu">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <div class="logo-circle">AJ</div>
                    <button class="mobile-menu-close" id="mobile-menu-close">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <nav class="mobile-nav">
                    <ul>
                        <li><a href="index.html" class="mobile-nav-link">HOME</a></li>
                        <li><a href="about.html" class="mobile-nav-link">ABOUT</a></li>
                        <li><a href="classes.html" class="mobile-nav-link">CLASSES</a></li>
                        <li><a href="blog.html" class="mobile-nav-link">BLOG</a></li>
                        <li><a href="contact.html" class="mobile-nav-link">CONTACT US</a></li>
                    </ul>
                </nav>
                <div class="mobile-menu-footer">
                    <a href="contact.html#contact-form" class="mobile-book-btn">BOOK CLASS</a>
                </div>
            </div>
        </div>

        <!-- Blog Hero -->
        <section class="blog-hero">
            <h1 class="blog-title">OUR <span class="highlight">JOURNAL</span></h1>
            <p class="blog-subtitle">INSIGHTS ON YOGA, WELLNESS, AND MINDFUL LIVING</p>
        </section>

        <!-- Blog Grid -->
        <section class="blog-grid" id="blog-grid">
            <!-- Loading state -->
            <div id="blog-loading" style="text-align: center; padding: 3rem; grid-column: 1 / -1;">
                <p style="font-size: 1.2rem; color: var(--secondary-text);">Loading blogs...</p>
            </div>
            <!-- Error state (hidden by default) -->
            <div id="blog-error" style="display: none; text-align: center; padding: 3rem; grid-column: 1 / -1;">
                <p style="font-size: 1.2rem; color: #d32f2f;">Failed to load blogs. Please try again later.</p>
            </div>
            <!-- Blog posts will be dynamically inserted here -->
        </section>

        <!-- Newsletter / Footer Area -->
        <section class="newsletter">
            <div class="newsletter-content">
                <h2>SUBSCRIBE TO OUR NEWSLETTER</h2>
                <p>Get the latest updates, articles, and class schedules delivered to your inbox.</p>
                <form class="newsletter-form">
                    <input type="email" placeholder="Enter your email address">
                    <button type="submit">SUBSCRIBE</button>
                </form>
            </div>
        </section>

        <!-- Footer -->
        <footer class="about-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo-circle">A</div>
                    <p>Ashika Jain Yoga Studio</p>
                </div>
                <div class="footer-section">
                    <h4>CONTACT</h4>
                    <p>123 Wellness Street<br>Your City, ST 12345<br>contact@ashikajain.com</p>
                </div>
                <div class="footer-section">
                    <h4>HOURS</h4>
                    <p>Monday - Friday: 6am - 9pm<br>Saturday - Sunday: 8am - 6pm</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Supabase Configuration loaded from config.js
        // Make sure to update config.js with your actual Supabase credentials
        const SUPABASE_URL = SUPABASE_CONFIG.url;
        const SUPABASE_ANON_KEY = SUPABASE_CONFIG.anonKey;

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options).toUpperCase();
        }

        // Function to render blog posts
        function renderBlogPosts(blogs) {
            const blogGrid = document.getElementById('blog-grid');
            const loadingDiv = document.getElementById('blog-loading');
            const errorDiv = document.getElementById('blog-error');

            // Hide loading and error states
            if (loadingDiv) loadingDiv.style.display = 'none';
            if (errorDiv) errorDiv.style.display = 'none';

            if (!blogs || blogs.length === 0) {
                blogGrid.innerHTML = '<div style="text-align: center; padding: 3rem; grid-column: 1 / -1;"><p style="font-size: 1.2rem; color: var(--secondary-text);">No blog posts found.</p></div>';
                return;
            }

            // Clear existing content (except loading/error divs)
            const existingPosts = blogGrid.querySelectorAll('.blog-card');
            existingPosts.forEach(post => post.remove());

            // Render each blog post
            blogs.forEach(blog => {
                const blogCard = document.createElement('article');
                blogCard.className = 'blog-card';

                // Format the date
                const formattedDate = blog.created_at ? formatDate(blog.created_at) : (blog.date || '');
                
                // Build the blog card HTML
                blogCard.innerHTML = `
                    <div class="card-image">
                        <img src="${blog.image_url || blog.image || 'nature.png'}" alt="${blog.title || 'Blog Post'}" onerror="this.src='nature.png'">
                        <div class="category-tag">${blog.category || 'GENERAL'}</div>
                    </div>
                    <div class="card-content">
                        <span class="date">${formattedDate}</span>
                        <h3>${blog.title || 'Untitled'}</h3>
                        <p>${blog.excerpt || blog.description || blog.content?.substring(0, 150) + '...' || 'No description available.'}</p>
                        <a href="blog-detail.html?id=${blog.id}" class="read-more">READ ARTICLE <i class="fa-solid fa-arrow-right-long"></i></a>
                    </div>
                `;

                blogGrid.appendChild(blogCard);
            });
        }

        // Function to fetch blogs from Supabase
        async function fetchBlogs() {
            const blogGrid = document.getElementById('blog-grid');
            const loadingDiv = document.getElementById('blog-loading');
            const errorDiv = document.getElementById('blog-error');

            try {
                // Show loading state
                if (loadingDiv) loadingDiv.style.display = 'block';
                if (errorDiv) errorDiv.style.display = 'none';

                // Fetch blogs from Supabase
                // Adjust the table name 'blogs' to match your Supabase table name
                const { data, error } = await supabase
                    .from('blogs')
                    .select('*')
                    .eq('published', true) // Only fetch published blogs
                    .order('created_at', { ascending: false }); // Order by most recent first

                if (error) {
                    throw error;
                }

                // Render the blogs
                renderBlogPosts(data);
            } catch (error) {
                console.error('Error fetching blogs:', error);
                
                // Show error state
                if (loadingDiv) loadingDiv.style.display = 'none';
                if (errorDiv) errorDiv.style.display = 'block';
            }
        }

        // Fetch blogs when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Check if Supabase is configured
            if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
                const errorDiv = document.getElementById('blog-error');
                const loadingDiv = document.getElementById('blog-loading');
                if (loadingDiv) loadingDiv.style.display = 'none';
                if (errorDiv) {
                    errorDiv.innerHTML = '<p style="font-size: 1.2rem; color: #d32f2f;">Please configure your Supabase credentials in the script section.</p>';
                    errorDiv.style.display = 'block';
                }
                return;
            }

            fetchBlogs();
        });

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuClose = document.getElementById('mobile-menu-close');
        const body = document.body;

        if (mobileMenuToggle) {
            mobileMenuToggle.addEventListener('click', () => {
                mobileMenu.classList.add('active');
                body.classList.add('menu-open');
            });
        }

        if (mobileMenuClose) {
            mobileMenuClose.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                body.classList.remove('menu-open');
            });
        }

        // Close menu when clicking on overlay (outside menu content)
        if (mobileMenu) {
            mobileMenu.addEventListener('click', (e) => {
                if (e.target === mobileMenu) {
                    mobileMenu.classList.remove('active');
                    body.classList.remove('menu-open');
                }
            });
        }

        // Close menu when clicking on a nav link
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.remove('active');
                body.classList.remove('menu-open');
            });
        });

        // Set active state for current page
        const currentPath = window.location.pathname;
        const currentPage = currentPath.split('/').pop() || 'index.html';
        mobileNavLinks.forEach(link => {
            const linkHref = link.getAttribute('href');
            if (linkHref === currentPage || (currentPage === '' && linkHref === 'index.html')) {
                link.classList.add('active');
            }
        });
    </script>

</body>

</html>